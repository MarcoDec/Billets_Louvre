{% extends '::base.html.twig' %}
{% block title %}Welcome in Le Louvre{% endblock %}

{% set prototype_commande = form.commandes.vars.prototype %}

{% macro information_prototype(commande) %}
    {{ form_widget(commande.tarif) }}
{% endmacro %}

{% macro information2_prototype(commande) %}
    {{ form_widget(commande.quantity) }}
{% endmacro %}

{% block stylesheets %}
    {{ parent() }}
    {#<link rel="stylesheet" href="{{ asset('bundles/adesignscalendar/css/fullcalendar/fullcalendar.css') }}" />
    <link rel="stylesheet" href="{{ asset('bundles/MDPlanning/css/styles.css') }}" />#}
    <link rel="stylesheet" href="{{ asset('bundles/occore/css/styles.css') }}" />
{% endblock %}

{% block body %}
    <div class="container-fluid">
            <div class="row">
                <div class="col-md-offset-1 col-md-10">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 hidden-xs hidden-sm">
                            <img src="{{asset('bundles/MDPlanning/img/LeLouvre.png')}}" alt="Le Louvre"/>
                        </div>
                    </div>
                    <div class="row">
                        <aside class="col-xm-12 col-md-5">
                            <div class="row">
                                {% for key, tarif in tarifs %}
                                    <div class='col-xs-6 col-sm-4 col-lg-3 lowPadding'>
                                        <article>
                                            <!-- Tarif -->
                                            <tarif class="col-xs-12 lowPadding">Tarif {{key|upper}}</tarif>
                                            <!-- Nombre de billet -->
                                            <div class="col-xs-7 lowPadding">
                                                {% if tarif.nbBillets > 1 %}
                                                    <nbillets>{{ tarif.nbBillets }} billets</nbillets>
                                                {% else %}
                                                    <nbillets>{{ tarif.nbBillets }} billet</nbillets>
                                                {% endif %}
                                            </div>
                                            <!-- Prix des billets -->
                                            <div class="col-xs-5 lowPadding">
                                                <prix>{{ tarif.prix }}<span class="glyphicon glyphicon-euro"></span></prix>
                                            </div>
                                            <!-- Description -->
                                            <div class="{#hidden-xs hidden-sm #}col-md-12 lowPadding">
                                                <desc>{{ tarif.description }}</desc>
                                            </div>
                                            <!-- info commande en cours: Nombre de personne / Tarif concerné -->
                                            <div class="col-xs-2 lowPadding">
                                                <tete><span class="glyphicon glyphicon-user"></span></tete>
                                            </div>
                                            <div class="col-xs-6 lowPadding">
                                                <people  key="{{ key }}">0</people>
                                            </div>
                                            <!-- bouton de commande d'ajout d'un tarif -->
                                            <div class="col-xs-2 lowPadding">
                                                <plus name="plus" key="{{ key }}" prix="{{ tarif.prix }}" nBillets="{{ tarif.nbBillets }}"><span class="glyphicon glyphicon-plus-sign"></span></plus>
                                            </div>
                                            <!-- bouton de commande de retrait d'un tarif -->
                                            <div class="col-xs-2 lowPadding">
                                                <moins name="moins" key="{{ key }}" prix="{{ tarif.prix }}" nBillets="{{ tarif.nbBillets }}"><span class="glyphicon glyphicon-minus-sign"></span></moins>
                                            </div>
                                        </article>
                                    </div>
                            {% endfor %}
                        </div>
                        </aside>
                        <div class="col-md-1 hidden-xs hidden-sm"></div>
                        <section class="col-xm-12 col-md-6 lowPadding">
                                {{ form_start(form, {'method': 'POST'}) }}
                                    <div class="col-xs-12 lowPadding">
                                    <legend><span class="glyphicon glyphicon-shopping-cart"></span> VOTRE COMMANDE</legend>
                                    <div class="col-xs-12 lowPadding" hidden>Erreurs : {{ form_errors(form) }} </div>  
                                    </div>
                                        <div class="col-xs-6 lowPadding" style="height: 75px;">
                                            {{ form_row(form.dateReservation, {'class':'form-control'}) }}
                                            <p class="info">Le Louvre est fermé les samedis et dimanches.</p>
                                        </div>
                                        <div class="col-xs-6 lowPadding"  style="height: 75px;">
                                            {{ form_row(form.demiJournee, {'class':'form-control'}) }}
                                            <p class="info">Toute réservation pour la 1/2 journée courantes doit être passée avant 14h00.</p>
                                        </div>
                                    <div class="col-xs-12 lowPadding">
                                    <table>
                                        <thead>
                                            <tr>
                                                    <th width="20%">Tarif</th>
                                                    <th width="10%">Prix unitaire</th>
                                                    <th width='10%'>Quantité</th>
                                                    <th width='20%'>Total</th>
                                                    <th width='10%'>Nb de place</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tableau">
                                            {% for commande in form.commandes %}
                                                <tr hidden id="{{ commande.vars.value.tarif.getTarifKey }}" prix="{{ commande.vars.value.tarif.getCout }}" nbBillets="{{ commande.vars.value.tarif.nbBillets }}" amount="0" place='0'>
                                                    
                                                    {#<td>{{ _self.information_prototype(commande) }}</td>#}
                                                    <td>{{ form_widget(commande.tarif) }}</td>

                                                    <td>{{ commande.vars.value.tarif.getCout }}<span class="glyphicon glyphicon-euro"></span></td>

                                                    <td>{{ form_widget(commande.quantity) }}</td>       

                                                    <td class="sous-total" id="{{ commande.vars.value.tarif.getTarifKey }}_st">  <span class="glyphicon glyphicon-euro"></span></td>
                                                    <td><place id="{{ commande.vars.value.tarif.getTarifKey }}_pl"></place></td>
                                                </tr>
                                            {% endfor %}
                                                
                                                {#{% for key, tarif in tarifs %}
                                                    <tr hidden id="{{ key }}" prix="{{ tarif.prix }}" nbBillets="{{ tarif.nbBillets }}" amount="0" place='0'>
                                                        {#<td>{{ key|upper }}</td>
                                                                <td>
                                                                            <input type="text" id="oc_commandebundle_CommandeGlobale_commandes_{{ loop.index0 }}_tarif" name="oc_commandebundle_CommandeGlobale[commandes][{{ loop.index0 }}][tarif]" required="required" value="{{ key|upper }}" disabled/>
                                                                </td>
                                                        
                                                        <td>{{ tarif.prix }}<span class="glyphicon glyphicon-euro"></span></td>
                                                        
                                                        {#<td><input name="oc_commandebundle_CommandeGlobale[nbBillets]" type="number" width="10px" style="text-align:center;color:black;" min="0" id="{{ key }}_nb" disabled/></td>
                                                        <td><input id="oc_commandebundle_CommandeGlobale_commandes_{{ loop.index0 }}_quantity" type="number" width="10px" style="text-align:center;color:black;" min="0" name="oc_commandebundle_CommandeGlobale[commandes][{{ loop.index0 }}][quantity]" required value="0" disabled/></td>       
                                                        
                                                        <td class="sous-total" id="{{ key }}_st">  <span class="glyphicon glyphicon-euro"></span></td>
                                                        <td><place id="{{ key }}_pl"></place></td>
                                                    </tr>
                                                {% endfor %}#}
                                        </tbody>
                                        <tfoot>
                                                <tr>
                                                    <th colspan="3">TOTAL:</th>
                                                    <th id="total">0<span class="glyphicon glyphicon-euro"></span></th>
                                                    <th id="places">0</th>
                                                </tr>
                                        </tfoot>

                                    </table>
                                            

                                        </div>
                                            
                                        {{ form_row(form.Reserver, {'class':'form-control'}) }}

                                </div>
                                
                            {{ form_end(form) }}
                  
                           {# {{ form(form) }}#}
                         
                                
                                
                </section>
                <!--<section class="col-lg-8 col-sm-12" id="calendar">
                    {#{% include 'ADesignsCalendarBundle::calendar.html.twig' %}#}
                </section>-->
                        <!--<form id="annulation">
                            <legend>ANNULATIONS</legend>
                            <label for="theDate">Date</label>
                            <input type="date" id='theDate' name='theDate' class="form-control">
                            <label for="refCommande">Référence de la commande</label>
                            <input type='text' id='refCommande' name='refCommande' class="form-control">
                                <input type='submit' value='Annuler Billet(s)'>
                        </form>-->
            </div>
                </div>
            </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {#<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/adesignscalendar/js/jquery/jquery-1.8.2.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/adesignscalendar/js/fullcalendar/jquery.fullcalendar.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/adesignscalendar/js/calendar-settings.js') }}"></script> 
    <script type="text/javascript" src="{{ asset('bundles/MDPlanning/js/myEvents.js') }}"></script>#}
    <script type="text/javascript" src="{{ asset('bundles/occore/js/events.js') }}"></script>
{% endblock %}